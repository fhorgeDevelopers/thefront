(()=>{
    $(window).scroll($.throttle(0, (function() {
        $(window).width() > 480 && $("#autocomp--new").hide()
    }
    ))),
    $("body").on("click", (function(e) {
        0 !== $(e.target).parents("#autocomp--new").length || $(e.target).is($("#search_icon")) || $(e.target).is($(".autocomplete_field")) || $("#autocomp--new").hide()
    }
    ));
    var e = {
        en: "/tag/english-language",
        es: "/es/etiquetar/idioma-ingles",
        fr: "/fr/tag/langue-anglaise",
        it: "/it/tag/lingua-inglese",
        "pt-BR": "/pt-BR/etiqueta/idioma-ingles"
    }
      , t = {
        options: {
            typeLength: 2,
            inputBox: document.querySelectorAll(".autocomplete_field")
        },
        onType: function() {
            var e, t = this;
            $.each(this.options.inputBox, (function() {
                this.onclick = function() {
                    var e = $(this)
                      , t = $(this).parent().find("#autocomp--new");
                    console.log(e.val().length),
                    e.val().length > 4 && t.length > 0 && (t.fadeIn(),
                    e.off("focus"))
                }
                ,
                this.onkeyup = t.throttle((function(a) {
                    $(".active-input").removeClass("active-input"),
                    $(this).addClass("active-input");
                    var n = $(this).val()
                      , r = $(this)
                      , i = $(this).parent().find("#autocomp--new");
                    13 === a.which ? (i.hide(),
                    r.focus((function() {
                        r.val().length > 4 && (i.fadeIn(),
                        r.off("focus"))
                    }
                    )),
                    s(),
                    i.find("a.selected").is("a") ? i.find("a.selected")[0].click() : "" !== r.val() && 0 === $("#search-heading").length && "undefined" != typeof sessionStorage && (sessionStorage.setItem("_last_search_query", "&query=" + $(this).val()),
                    sessionStorage.removeItem("_onbeforeunload"),
                    sessionStorage.removeItem("_filter_cats"),
                    sessionStorage.removeItem("_filter_langs"),
                    sessionStorage.removeItem("_filter_inpts"))) : (!i.is(":visible") && r.val().length > 4 && i.fadeIn(),
                    8 === a.keyCode && (e = !1),
                    38 === a.which || 40 === a.which ? (!0,
                    i.find("a.selected").each((function() {
                        e = !0,
                        $(this).removeClass("selected");
                        var t = $(".autocomplete--search-categories > a")
                          , s = $(".autocomplete--search-careers > a")
                          , n = $(".autocomplete--search-terms > a");
                        38 === a.which && ($(this).html() === t.first().html() ? n.last().addClass("selected") : $(this).html() === s.first().html() ? t.length ? t.last().addClass("selected") : n.last().addClass("selected") : $(this).html() === n.first().html() ? s.length ? s.last().addClass("selected") : t.length ? t.last().addClass("selected") : n.last().addClass("selected") : $(this).prev().addClass("selected")),
                        40 === a.which && ($(this).html() === n.last().html() ? t.length ? t.first().addClass("selected") : s.length ? s.first().addClass("selected") : n.first().addClass("selected") : $(this).html() === s.last().html() ? n.first().addClass("selected") : $(this).html() === t.last().html() ? s.length ? s.first().addClass("selected") : n.first().addClass("selected") : $(this).next().addClass("selected"))
                    }
                    )),
                    e || i.find("a").first().addClass("selected")) : n.length > t.options.typeLength ? t.fetchApi(n) : i.fadeOut((function() {
                        $(this).remove()
                    }
                    )))
                }
                ), 10),
                this.onkeydown = function(e) {
                    if (38 === e.which)
                        return e.preventDefault(),
                        !1
                }
                ,
                this.onkeypress = function(e) {
                    if (38 === e.which)
                        return e.preventDefault(),
                        !1
                }
            }
            ))
        },
        throttle: function(e, t) {
            var s = 0;
            return function() {
                var a = this
                  , n = arguments;
                clearTimeout(s),
                s = setTimeout((function() {
                    e.apply(a, n)
                }
                ), t || 0)
            }
        },
        fetchApi: function(s) {
            if (s) {
                var a = "";
                $.ajaxSetup({
                    beforeSend: function(e) {
                        e.setRequestHeader("x-header-host", "oTbrPD9HRO+jdciawiXuh4vUgB8=")
                    }
                }),
                $.ajax({
                    type: "GET",
                    url: window.apiEndpoint + "/course/autocomplete/" + window.locale + "?query=" + s,
                    dataType: "json",
                    async: !0,
                    success: function(s) {
                        if (200 === s.status)
                            if (s.result.hasOwnProperty("queries") && null !== s.result.queries && s.result.queries.length > 0 || s.result.hasOwnProperty("tags") && null !== s.result.tags && s.result.tags.length > 0 || s.result.hasOwnProperty("careers") && null !== s.result.careers && s.result.careers.length > 0) {
                                if (a += '<div><p class="autocomplete-title">Popular Search Terms</p>',
                                s.result.hasOwnProperty("tags") && null !== s.result.tags && s.result.tags.length > 0) {
                                    a += '<div class="autocomplete--search-categories">';
                                    for (var n = 0; n < s.result.tags.length; n++)
                                        a += '<a class="new new--link" href="' + window.tagPage + "index.html" + s.result.tags[n].slug + '"><span class="search-term-icon search--categories icon-search2"></span> <span class="autocomp-t">' + s.result.tags[n].formattedName + '</span><span class="autocomp-ty">in subjects</span></a>';
                                    a += "</div>"
                                }
                                if (s.result.hasOwnProperty("careers") && null !== s.result.careers && s.result.careers.length > 0) {
                                    a += '<div class="autocomplete--search-careers">';
                                    for (n = 0; n < Math.min(s.result.careers.length, 5); n++)
                                        a += '<a class="new new--link" href="' + window.careerPage + "index.html" + s.result.careers[n].slug + '"><span class="search-term-icon search--terms icon-search2"></span>  <span class="autocomp-t">' + s.result.careers[n].formattedName + '</span><span class="autocomp-ty">in careers</span></a>';
                                    a += "</div>"
                                }
                                if (s.result.hasOwnProperty("queries") && null !== s.result.queries && s.result.queries.length > 0) {
                                    a += '<div class="autocomplete--search-terms">';
                                    for (n = 0; n < Math.min(s.result.queries.length, 5); n++) {
                                        var r = window.searchPage + "?query=" + s.result.queries[n].name;
                                        "english" !== s.result.queries[n].name && "english language" !== s.result.queries[n].name || (r = e[language]),
                                        a += '<a class="new new--link" href="' + r + '"><span class="search-term-icon search--terms icon-search2"></span> <span class="autocomp-t">' + s.result.queries[n].formattedName + "</span></a>"
                                    }
                                    a += "</div>"
                                }
                                a += '<span class="view-all-results">View all results</span>',
                                a += "</div>",
                                t.buildHtml(a)
                            } else
                                t.buildHtml("")
                    },
                    error: function(e) {
                        console.log("/F1 err/: ", e)
                    }
                })
            }
        },
        buildHtml: function(e) {
            if ("" === e)
                return $(".active-input").removeClass("active-input"),
                void $("#autocomp--new").remove();
            var t = "";
            null === document.getElementById("autocomp--new") ? (t = document.createElement("div")).id = "autocomp--new" : (t = document.getElementById("autocomp--new")).innerHTML = "",
            t.insertAdjacentHTML("beforeend", e),
            $(".active-input")[0].parentNode.appendChild(t)
        }
    };
    function s() {
        var t = !1
          , s = "english" === $(".active-input").val().toLowerCase() || "english language" === $(".active-input").val().toLowerCase();
        if ($(".autocomplete--search-categories .new--link").first().length && $(".autocomplete--search-categories .new--link").first().attr("href").indexOf("/tag/english-language") > -1 && (s = !0),
        s && (t = !0,
        location.href = e[language]),
        !t) {
            var a = $(".active-input").val();
            $(".active-input").parent().submit(),
            setTimeout((function() {
                $(".active-input").val(a)
            }
            ), 0)
        }
    }
    null !== document.querySelectorAll(".autocomplete_field") && t.onType(),
    $("body").on("click", ".view-all-results", (function(e) {
        e.preventDefault(),
        $(".active-input").parent().submit()
    }
    )),
    $("#search_icon").click((function() {
        0 === $(".active-input").length ? $(this).parents("form").submit() : "" !== $(".active-input").val() ? ("undefined" != typeof sessionStorage && (sessionStorage.setItem("_last_search_query", "&query=" + $(".active-input").val()),
        sessionStorage.removeItem("_onbeforeunload"),
        sessionStorage.removeItem("_filter_cats"),
        sessionStorage.removeItem("_filter_langs"),
        sessionStorage.removeItem("_filter_inpts")),
        s()) : $(".active-input").focus()
    }
    )),
    $(document).on("click", "a.new--link", (function(e) {
        if ("autocomplete--search-terms" === $(this)[0].parentElement.className) {
            var t = $(this).text().trim();
            $(".autocomplete--search-categories a").each((function(s, a) {
                $(a).find(".autocomp-t").text().trim().toLowerCase() === t.toLowerCase() && (e.preventDefault(),
                location.href = $(a).attr("href"))
            }
            )),
            $(".autocomplete--search-careers a").each((function(s, a) {
                $(a).find(".autocomp-t").text().trim().toLowerCase() === t.toLowerCase() && (e.preventDefault(),
                location.href = $(a).attr("href"))
            }
            ))
        }
        "" !== e.target.textContent && "undefined" != typeof sessionStorage && (sessionStorage.setItem("_last_search_query", "&query=" + e.target.textContent),
        sessionStorage.removeItem("_onbeforeunload"),
        sessionStorage.removeItem("_filter_cats"),
        sessionStorage.removeItem("_filter_langs"),
        sessionStorage.removeItem("_filter_inpts"))
    }
    ))
}
)();
